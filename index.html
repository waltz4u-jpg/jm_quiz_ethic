<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>μƒν™κ³Ό μ¤λ¦¬ OX ν€΄μ¦</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
  background:#121212;
  color:#E0E0E0;
  font-family:'Pretendard','Noto Sans KR',sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}
.container{
  width:90%;
  max-width:500px;
}
.card{
  background:#1E1E1E;
  padding:20px;
  border-radius:12px;
}
.ox-btn{
  width:100%;
  padding:14px;
  margin:10px 0;
  border:none;
  border-radius:10px;
  font-size:18px;
  cursor:pointer;
  background:#2A2A2A;
  color:white;
  transition:0.2s;
}
.ox-btn:hover{ background:#333; }
.correct{ background:#2E7D32 !important; }
.wrong{ background:#C62828 !important; }
.small{ font-size:14px; color:#9E9E9E; }
button{
  margin-top:10px;
  padding:10px;
  width:100%;
  border:none;
  border-radius:8px;
  background:#333;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h2>π“ μƒν™κ³Ό μ¤λ¦¬ OX ν€΄μ¦</h2>
    <div id="progress" class="small"></div>
    <h3 id="question"></h3>
    <button class="ox-btn" onclick="checkAnswer('O', this)">β­• O</button>
    <button class="ox-btn" onclick="checkAnswer('X', this)">β X</button>
    <div id="result"></div>
    <button onclick="nextQuestion()">λ‹¤μ λ¬Έμ </button>
    <button onclick="showWrongNotes()">π“’ μ¤λ‹µλ…ΈνΈ</button>
  </div>
</div>

<audio id="successSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

<script>

const SHEET_URL =
"https://opensheet.elk.sh/1aWuK6r5KQ7oOXqUmPkYDLVF1kb9sWAAvdbIgsgGUJ7k/Sheet1";

let quizData=[];
let currentSet=[];
let currentIndex=0;
let solvedCount=0;

async function loadDB(){
  if(!localStorage.getItem("quizDB")){
    const res=await fetch(SHEET_URL);
    const data=await res.json();
    localStorage.setItem("quizDB",JSON.stringify(data));
  }
  quizData=JSON.parse(localStorage.getItem("quizDB"));
}

function getRandomQuestions(count=5){
  return [...quizData].sort(()=>0.5-Math.random()).slice(0,count);
}

function loadQuiz(){
  currentSet=getRandomQuestions(5);
  currentIndex=0;
  solvedCount=0;
  showQuestion();
}

function showQuestion(){
  const q=currentSet[currentIndex];

  document.getElementById("progress").innerText=
    `${currentIndex+1} / 5 λ¬Έμ `;

  document.getElementById("question").innerText=
    q.problem;

  document.getElementById("result").innerHTML="";
}

function checkAnswer(selected,btn){
  const q=currentSet[currentIndex];
  const buttons=document.querySelectorAll(".ox-btn");
  buttons.forEach(b=>b.disabled=true);

  if(selected===q.answor){
    btn.classList.add("correct");
    document.getElementById("result").innerHTML=
      "β… μ •λ‹µμ…λ‹λ‹¤!<br><br>"+q.explanation;
  }else{
    btn.classList.add("wrong");
    document.getElementById("result").innerHTML=
      "β μ¤λ‹µμ…λ‹λ‹¤.<br><br>"+q.explanation;
    saveWrong(q);
  }

  solvedCount++;

  if(solvedCount===5){
    setTimeout(celebrate,800);
  }
}

function nextQuestion(){
  if(currentIndex<4){
    currentIndex++;
    document.querySelectorAll(".ox-btn").forEach(b=>{
      b.disabled=false;
      b.classList.remove("correct","wrong");
    });
    showQuestion();
  }
}

function saveWrong(q){
  let wrong=JSON.parse(localStorage.getItem("wrongNotes"))||[];
  if(!wrong.find(item=>item.problem===q.problem)){
    wrong.push(q);
    localStorage.setItem("wrongNotes",JSON.stringify(wrong));
  }
}

function showWrongNotes(){
  const wrong=JSON.parse(localStorage.getItem("wrongNotes"))||[];
  if(wrong.length===0){
    alert("μ¤λ‹µλ…ΈνΈκ°€ λΉ„μ–΄μμµλ‹λ‹¤.");
    return;
  }
  let text="π“’ μ¤λ‹µλ…ΈνΈ\n\n";
  wrong.forEach((q,i)=>{
    text+=`${i+1}. ${q.problem}\nμ •λ‹µ: ${q.answor}\n\n`;
  });
  alert(text);
}

function celebrate(){
  confetti({
    particleCount:200,
    spread:120,
    origin:{y:0.6}
  });
  document.getElementById("successSound").play();
  document.getElementById("result").innerHTML=
    "π‰ μ¤λμ ν•™μµ μ™„λ£! μ •λ§ μκ³ ν–μ–΄μ”!";
}

loadDB().then(loadQuiz);

</script>

</body>
</html>
